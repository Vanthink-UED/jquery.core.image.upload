!function(t){function i(i,n){this.$el=t(i),this.options=t.extend({},t.fn[e].defaults,n),this.init()}var e="coreImageUpload",n=function(i,e,n){if(this.image={file:i},this.options=e,this.uploadAction=n,i){var o=new FileReader,a=this;o.onload=function(t){a.image.src=t.target.result,a.show()},o.readAsDataURL(i[0])}this.dialog=t('<div class="g-core-image-corp-container"></div>'),this.imageAside=t('<div class="image-aside"></div>'),this.infoAside=t('<div class="info-aside"></div>')};n.prototype={show:function(){this.dialog.append(this.imageAside,this.infoAside),t("body").append(this.dialog),this._initButtons(),this._initCropBox(),this._bind()},hide:function(){this.dialog.remove()},initPic:function(t){var i=new Image;i.src=this.image.src,i.onload=function(){this.image.width=i.naturalWidth,this.image.height=i.naturalHeight,this.reseyLayout(i,t),this.showCropBox(t,"create")}.bind(this)},reseyLayout:function(i,e){var n=window.innerHeight-80,o=window.innerWidth-60,a=this.image.width,s=this.image.height,r=a/s,d=o/n;r>d?(t(i).css({width:o,height:o/r}),e&&e.css({width:o,height:o/r,"margin-top":(n-o/r)/2})):(t(i).css({width:n*r,height:n}),e&&e.css({width:n*r,height:n,"margin-left":(o-n*r)/2})),e?e.append(i):this.imageAside.append(i),this.options.imgChangeRatio=a/i.width},_bind:function(){var i=this;this.btnUpload.on("click",function(t){i.doCropEvent(t)}),this.btnCancel.on("click",function(){i.dialog.remove(),t(".g-core-image-upload-element").find("input[type=file]").val("")})},_initButtons:function(){this.btnUpload=t('<button type="button" class="btn btn-upload">确定</button>'),this.btnCancel=t('<button type="button" class="btn btn-cancel">取消</button>');var i=t('<p class="btn-groups"></p>');i.append(this.btnUpload,this.btnCancel),this.infoAside.append(i)},setNotice:function(i){this.notice=t('<div class="notice-info">'+i.errmsg+"</div>"),this.infoAside.find("notice-info").length?this.notice.text(i.errmsg):this.infoAside.prepend(this.notice),this.response.errno&&this.notice.show,2==this.response.errno&&this.infoAside.find(".notice-info").addClass("errro")},_outputImageDetails:function(){var i=t('<table class="image-details"></table>'),e="<tr><td>图片名称</td><td>"+this.response.data.name+"</td></tr>";e+="<tr><td>图片宽度</td><td>"+this.response.data.width+"px</td></tr>",e+="<tr><td>图片高度</td><td>"+this.response.data.height+"px</td></tr>",i.html(e);var n=t('<div class="config-info"></div>');n.append(i),this.infoAside.append(n)},_initCropBox:function(){this.imageAside.append('<div class="g-crop-image-box"><div class="g-crop-image-principal"><div></div>');var t=this.imageAside.find(".g-crop-image-principal");this.initPic(t)},showCropBox:function(i,e){var n=t('<div class="select-recorte"></div>');i.append(n);var o=parseInt(i.css("width")),a=parseInt(i.css("height")),s=this.options.cropRatio.split(":")[0],r=this.options.cropRatio.split(":")[1],d=o/100*80,p=d/s*r;if(n.css({width:d,height:p,left:(o-d)/2,top:(a-p)/2}),p>a&&(p=a/100*80,d=p*s/r,n.css({width:d,height:p,left:(o-d)/2,top:(a-p)/2})),"create"==e){n.resizable({containment:"parent",aspectRatio:this.options.cropRatio,minWidth:d/100*10,minHeight:p/100*10,resize:function(i){{var e=t(i.target);e.css("left"),e.css("top"),e.width(),e.height()}}}),n.draggable({containment:"parent",drag:function(i){{var e=t(i.target);e.css("left"),e.css("top"),e.width(),e.height()}}}),t("body>div").bind("dragstart",function(t){t.stopPropagation()})}},doCropEvent:function(i){var e=t(i.target);e.attr("disabled","disabled"),e.text("裁剪中...");var n=this.dialog.find(".select-recorte"),o=this.options.cropRatio.split(":")[0],a=this.options.cropRatio.split(":")[1],s={};s.request="crop",s.toCropImgX=parseInt(n.css("left"))*this.options.imgChangeRatio,s.toCropImgY=parseInt(n.css("top"))*this.options.imgChangeRatio,s.toCropImgW=n.width()*this.options.imgChangeRatio,s.toCropImgH=n.height()*this.options.imgChangeRatio,s.maxWidth=t(".maxWidthHeight input[name='maxwidth']").val(),s.maxHeight=t(".maxWidthHeight input[name='maxheight']").val(),s.ratioW=o,s.ratioH=a;this.options.data=t.extend(this.options.data,s),this.uploadAction()}};var o={clear:function(){},init:function(){var i=this.options;if(""==i.url)return alert("options.url must be defined");if(""==i.inputOfFile)return alert("options.inputOfFile must be defined");var e=function(e){e.css({cursor:"pointer",overflow:"hidden"}).addClass("g-core-image-upload-element"),e.on("dragenter",function(n){t(n.target).attr("name")==i.inputOfFile?e.addClass("picture-dropped"):e.removeClass("picture-dropped"),n.stopPropagation(),n.preventDefault()}),t(document).on("drop dragend",function(t){e.removeClass("picture-dropped"),t.stopPropagation()}),e.on("mouseout",function(t){e.removeClass("picture-dropped"),t.stopPropagation()});var n=t("<input type='hidden' name='"+i.InputOfImageDirectory+"' id='"+i.InputOfImageDirectory+"'>");n.addClass("picture-element-image-directory"),e.append(n)};e(this.$el),this.__buildForm(),i.enableButton&&($enableButton=t("<input type='button' value='Selecionar imagem' />").button().css({"font-size":"12px","margin-top":5,"margin-left":"-0.5px"}),Elemento.after($enableButton),$enableButton.unbind("click").bind("click",function(){Elemento.find("input[name='"+i.inputOfFile+"']:file").click()}))},__buildForm:function(){var i=this.$el,e=this.options;i.css("position","relative");var o='<form  method="post" enctype="multipart/form-data" action="'+e.url+'">';o+='<input name="'+e.inputOfFile+'" type="file" accept="image/*" />';var a=[];if("object"==typeof e.data)for(var s in e.data){var r='<input type="hidden" name='+s+'> value="'+e.data[s]+'"';a.push(r)}o+=a.join("")+"</form>";var d=t(o),p=d.find('input[type="file"]');d.css("display","none"),d.css({cursor:"pointer",display:"block",position:"absolute",left:0,top:0,width:parseInt(i.css("width"))<=0?i.width():parseInt(i.css("width")),height:parseInt(i.css("height"))<=0?i.height():parseInt(i.css("height")),cursor:"hand",opacity:0,margin:0,padding:0,overflow:"hidden"}),p.css({width:"100%",height:"100%"});var h=this;p.on("change",function(t){var i=p.val().replace(/C:\\fakepath\\/i,""),o=i.substring(i.lastIndexOf(".")+1);if(e.extensions.length>1){var a=new RegExp("^["+e.extensions.join("|")+"]+$","i");if(!a.test(o))return e.extensionError()}if(t.target.files[0].size>e.maxFileSize){var s;return s=parseInt(e.maxFileSize/1024/1024)>0?(e.maxFileSize/1024/1024).toFixed(2)+"MB":parseInt(e.maxFileSize/1024)>0?(e.maxFileSize/1024).toFixed(2)+"kB":e.maxFileSize.toFixed(2)+"Byte",void e.maximumSizeError}return e.files=t.target.files,e.enableCrop?void(h.imageBoxObj=new n(t.target.files,e,function(){h.tryAjaxUpload(d)})):(e.isAjax&&h.tryAjaxUpload(d),void d.find("input[type=file]").attr("disabled","disabled"))}),i.append(d)},tryAjaxUpload:function(i){var e=this,n=new FormData;t.each(this.options.files,function(t,i){n.append(e.options.inputOfFile,i)}),"object"==typeof e.options.data&&t.each(this.options.data,function(t,i){n.append(t,i)}),t.ajax({url:this.options.url,type:"POST",data:n,cache:!1,dataType:"json",processData:!1,contentType:!1,success:function(t){i.find("input[type=file]").removeAttr("disabled"),e.options.enableCrop&&(e.imageBoxObj.hide(),e.imageBoxObj=null),i.find("input[type=file]").val(""),e.options.uploadedCallback(t)},error:function(t,i){console.error("ERRORS: "+i)}})},tryIframeUpload:function(i){f||(f=t('<iframe id="core-image-upload-iframe" name="core-image-upload-iframe"></iframe>').attr("style",'style="width:0px;height:0px;border:0px solid #fff;"').hide(),f.attr("src",""),t(document.body).append(f));var e=function(){i.find("input[type=file]").removeAttr("disabled");a(this).contents().find("html body").text();i.get(0).reset(),this.options.uploadedCallback(data),f.unbind()};i.submit(function(t){f.load(e),i.attr("target","core-image-upload-iframe"),t.stopPropagation()})}};i.prototype=o,t.fn[e]=function(n,o){return this.each(function(){var a=t(this),s=a.data(e),r="object"==typeof n&&n;s||a.data(e,s=new i(this,r)),"string"==typeof n&&s[n](o)})},t.fn[e].defaults={extensions:["jpg","jpeg","gif","bmp","png"],extensionError:function(){},url:"",inputOfFile:"",onSubmit:function(){},data:{},isAjax:!0,maximumSize:1024,enableMaximumSize:!1,MaximumSizeError:function(){},enableCrop:!1,enableResize:!0,minimumWidthToResize:1,minimumHeightToResize:1,enableButton:!1,cropRatio:"16:9",imgChangeRatio:"",uploadedCallback:function(){}}}(jQuery);
//# sourceMappingURL=jquery.core.image.upload.min.js.map!function(t){function i(i,n){this.$el=t(i),this.options=t.extend({},t.fn[e].defaults,n),this.init()}var e="coreImageUpload",n=function(i,e,n){if(this.image={file:i},this.options=e,this.uploadAction=n,i){var o=new FileReader,a=this;o.onload=function(t){a.image.src=t.target.result,a.show()},o.readAsDataURL(i[0])}this.dialog=t('<div class="g-core-image-corp-container"></div>'),this.imageAside=t('<div class="image-aside"></div>'),this.infoAside=t('<div class="info-aside"></div>')};n.prototype={show:function(){this.dialog.append(this.imageAside,this.infoAside),t("body").append(this.dialog),this._initButtons(),this._initCropBox(),this._bind()},hide:function(){this.dialog.remove()},initPic:function(t){var i=new Image;i.src=this.image.src,i.onload=function(){this.image.width=i.naturalWidth,this.image.height=i.naturalHeight,this.reseyLayout(i,t),this.showCropBox(t,"create")}.bind(this)},reseyLayout:function(i,e){var n=window.innerHeight-80,o=window.innerWidth-60,a=this.image.width,s=this.image.height,r=a/s,d=o/n;r>d?(t(i).css({width:o,height:o/r}),e&&e.css({width:o,height:o/r,"margin-top":(n-o/r)/2})):(t(i).css({width:n*r,height:n}),e&&e.css({width:n*r,height:n,"margin-left":(o-n*r)/2})),e?e.append(i):this.imageAside.append(i),this.options.imgChangeRatio=a/i.width},_bind:function(){var t=this;this.btnUpload.on("click",function(i){t.doCropEvent(i)}),this.btnCancel.on("click",function(){t.dialog.remove()})},_initButtons:function(){this.btnUpload=t('<button type="button" class="btn btn-upload">确定</button>'),this.btnCancel=t('<button type="button" class="btn btn-cancel">取消</button>');var i=t('<p class="btn-groups"></p>');i.append(this.btnUpload,this.btnCancel),this.infoAside.append(i)},setNotice:function(i){this.notice=t('<div class="notice-info">'+i.errmsg+"</div>"),this.infoAside.find("notice-info").length?this.notice.text(i.errmsg):this.infoAside.prepend(this.notice),this.response.errno&&this.notice.show,2==this.response.errno&&this.infoAside.find(".notice-info").addClass("errro")},_outputImageDetails:function(){var i=t('<table class="image-details"></table>'),e="<tr><td>图片名称</td><td>"+this.response.data.name+"</td></tr>";e+="<tr><td>图片宽度</td><td>"+this.response.data.width+"px</td></tr>",e+="<tr><td>图片高度</td><td>"+this.response.data.height+"px</td></tr>",i.html(e);var n=t('<div class="config-info"></div>');n.append(i),this.infoAside.append(n)},_initCropBox:function(){this.imageAside.append('<div class="g-crop-image-box"><div class="g-crop-image-principal"><div></div>');var t=this.imageAside.find(".g-crop-image-principal");this.initPic(t)},showCropBox:function(i,e){var n=t('<div class="select-recorte"></div>');i.append(n);var o=parseInt(i.css("width")),a=parseInt(i.css("height")),s=this.options.cropRatio.split(":")[0],r=this.options.cropRatio.split(":")[1],d=o/100*80,p=d/s*r;if(n.css({width:d,height:p,left:(o-d)/2,top:(a-p)/2}),p>a&&(p=a/100*80,d=p*s/r,n.css({width:d,height:p,left:(o-d)/2,top:(a-p)/2})),"create"==e){n.resizable({containment:"parent",aspectRatio:this.options.cropRatio,minWidth:d/100*10,minHeight:p/100*10,resize:function(i){{var e=t(i.target);e.css("left"),e.css("top"),e.width(),e.height()}}}),n.draggable({containment:"parent",drag:function(i){{var e=t(i.target);e.css("left"),e.css("top"),e.width(),e.height()}}}),t("body>div").bind("dragstart",function(t){t.stopPropagation()})}},doCropEvent:function(i){var e=t(i.target);e.attr("disabled","disabled"),e.text("裁剪中...");var n=this.dialog.find(".select-recorte"),o=this.options.cropRatio.split(":")[0],a=this.options.cropRatio.split(":")[1],s={};s.request="crop",s.toCropImgX=parseInt(n.css("left"))*this.options.imgChangeRatio,s.toCropImgY=parseInt(n.css("top"))*this.options.imgChangeRatio,s.toCropImgW=n.width()*this.options.imgChangeRatio,s.toCropImgH=n.height()*this.options.imgChangeRatio,s.maxWidth=t(".maxWidthHeight input[name='maxwidth']").val(),s.maxHeight=t(".maxWidthHeight input[name='maxheight']").val(),s.ratioW=o,s.ratioH=a;this.options.data=t.extend(this.options.data,s),this.uploadAction()}};var o={clear:function(){},init:function(){var i=this.options;if(""==i.url)return alert("options.url must be defined");if(""==i.inputOfFile)return alert("options.inputOfFile must be defined");var e=function(e){e.css({cursor:"pointer",overflow:"hidden"}).addClass("g-core-image-upload-element"),e.on("dragenter",function(n){t(n.target).attr("name")==i.inputOfFile?e.addClass("picture-dropped"):e.removeClass("picture-dropped"),n.stopPropagation(),n.preventDefault()}),t(document).on("drop dragend",function(t){e.removeClass("picture-dropped"),t.stopPropagation()}),e.on("mouseout",function(t){e.removeClass("picture-dropped"),t.stopPropagation()});var n=t("<input type='hidden' name='"+i.InputOfImageDirectory+"' id='"+i.InputOfImageDirectory+"'>");n.addClass("picture-element-image-directory"),e.append(n)};e(this.$el),this.__buildForm(),i.enableButton&&($enableButton=t("<input type='button' value='Selecionar imagem' />").button().css({"font-size":"12px","margin-top":5,"margin-left":"-0.5px"}),Elemento.after($enableButton),$enableButton.unbind("click").bind("click",function(){Elemento.find("input[name='"+i.inputOfFile+"']:file").click()}))},__buildForm:function(){var i=this.$el,e=this.options;i.css("position","relative");var o='<form  method="post" enctype="multipart/form-data" action="'+e.url+'">';o+='<input name="'+e.inputOfFile+'" type="file" accept="image/*" />';var a=[];if("object"==typeof e.data)for(var s in e.data){var r='<input type="hidden" name='+s+'> value="'+data[s]+'"';a.push(r)}o+=a.join("")+"</form>";var d=t(o),p=d.find('input[type="file"]');d.css("display","none"),d.css({cursor:"pointer",display:"block",position:"absolute",left:0,top:0,width:parseInt(i.css("width"))<=0?i.width():parseInt(i.css("width")),height:parseInt(i.css("height"))<=0?i.height():parseInt(i.css("height")),cursor:"hand",opacity:0,margin:0,padding:0,overflow:"hidden"}),p.css({width:"100%",height:"100%"});var h=this;p.on("change",function(t){var i=p.val().replace(/C:\\fakepath\\/i,""),o=i.substring(i.lastIndexOf(".")+1);if(e.extensions.length>1){var a=new RegExp("^["+e.extensions.join("|")+"]+$","i");if(!a.test(o))return e.extensionError()}if(t.target.files[0].size>e.maxFileSize){var s;return s=parseInt(e.maxFileSize/1024/1024)>0?(e.maxFileSize/1024/1024).toFixed(2)+"MB":parseInt(e.maxFileSize/1024)>0?(e.maxFileSize/1024).toFixed(2)+"kB":e.maxFileSize.toFixed(2)+"Byte",void e.maximumSizeError}return e.files=t.target.files,e.enableCrop?void(h.imageBoxObj=new n(t.target.files,e,function(){h.tryAjaxUpload(d)})):(e.isAjax&&h.tryAjaxUpload(d),void d.find("input[type=file]").attr("disabled","disabled"))}),i.append(d)},tryAjaxUpload:function(i){var e=this,n=new FormData;t.each(this.options.files,function(t,i){n.append(e.options.inputOfFile,i)}),"object"==typeof e.options.data&&t.each(this.options.data,function(t,i){n.append(t,i)}),t.ajax({url:this.options.url,type:"POST",data:n,cache:!1,dataType:"json",processData:!1,contentType:!1,success:function(t){i.find("input[type=file]").removeAttr("disabled"),e.options.enableCrop&&(e.imageBoxObj.hide(),e.imageBoxObj=null),e.options.uploadedCallback(t)},error:function(t,i){console.error("ERRORS: "+i)}})},tryIframeUpload:function(i){f||(f=t('<iframe id="core-image-upload-iframe" name="core-image-upload-iframe"></iframe>').attr("style",'style="width:0px;height:0px;border:0px solid #fff;"').hide(),f.attr("src",""),t(document.body).append(f));var e=function(){i.find("input[type=file]").removeAttr("disabled");a(this).contents().find("html body").text();i.get(0).reset(),this.options.uploadedCallback(data),f.unbind()};i.submit(function(t){f.load(e),i.attr("target","core-image-upload-iframe"),t.stopPropagation()})}};i.prototype=o,t.fn[e]=function(n,o){return this.each(function(){var a=t(this),s=a.data(e),r="object"==typeof n&&n;s||a.data(e,s=new i(this,r)),"string"==typeof n&&s[n](o)})},t.fn[e].defaults={extensions:["jpg","jpeg","gif","bmp","png"],extensionError:function(){},url:"",inputOfFile:"",onSubmit:function(){},data:{},isAjax:!0,maximumSize:1024,enableMaximumSize:!1,MaximumSizeError:function(){},enableCrop:!1,enableResize:!0,minimumWidthToResize:1,minimumHeightToResize:1,enableButton:!1,cropRatio:"16:9",imgChangeRatio:"",uploadedCallback:function(){}}}(jQuery);
